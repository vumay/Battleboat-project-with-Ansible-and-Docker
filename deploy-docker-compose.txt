---

# important: before running this playbook you must install require roles with the folowing command
# sudo ansible-galaxy install -r roles/requirements.yml

# build and push builded images
- hosts: server
  become: true

  tasks:
    - name: Build Dockerfile
      docker_image:
        path: /opt/fake-backend
        name: battleboat-fe
        state: build

  post_tasks:
    - name: remove Dockerfile
      file:
        path: ./tmp
        state: absent
 # tasks:
   #- name: pull an image
     # docker_image:
     #   name: battleboat-fe:latest
      #  source: pull

# deploy app in production
    - name: Create docker directory
	 file:
        path: /opt/docker/battleboat
        state: directory
        owner: root
        group: root
        mode: 0755

    - name: Create docker-compose file
      template:
        src: docker-compose.yml.j2
        dest: /opt/docker/battleboat/docker-compose.yml
        owner: root
        group: root
        mode: 0644

    - name: Run docker-compose up -d
      shell: docker-compose up -d
      args:
        chdir: /opt/docker/battleboat
